generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  passwordHash  String    @map("password_hash")
  image         String?
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  teamMemberships TeamMember[]
  ownedTeams      Team[]         @relation("TeamOwner")
  invitations     TeamInvite[]   @relation("Invitee")
}

model Team {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  ownerId     String   @map("owner_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  owner       User         @relation("TeamOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members     TeamMember[]
  invites     TeamInvite[]
}

model TeamMember {
  id        String   @id @default(cuid())
  teamId    String   @map("team_id")
  userId    String   @map("user_id")
  role      String   @default("member")
  joinedAt  DateTime @default(now()) @map("joined_at")

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@map("team_members")
}

model TeamInvite {
  id        String   @id @default(cuid())
  teamId    String   @map("team_id")
  email     String
  inviterId String   @map("inviter_id")
  inviteeId String?  @map("invitee_id")
  token     String   @unique
  status    String   @default("pending")
  createdAt DateTime @default(now()) @map("created_at")
  expiresAt DateTime @map("expires_at")

  team    Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  invitee User? @relation("Invitee", fields: [inviteeId], references: [id])
  @@map("team_invites")
}
